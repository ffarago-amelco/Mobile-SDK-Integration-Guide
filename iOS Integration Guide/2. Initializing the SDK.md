# Initializing Optimove iOS SDK

## 1. Download the Optimove SDK

### Via Cocoapods

1. If you haven't already, add [Cocoapods](https://guides.cocoapods.org/using/getting-started.html) to your project:
   1. Close your _XCode_ project
   2. Open Terminal on your project's **root** folder.
   3. Run `pod init`
   4. Cocoapods will generate a **_Podfile_** that holds your app's modules and their dependencies (More [here](https://guides.cocoapods.org/using/the-podfile.html)).
2. Open your `Podfile`
3. Locate your App's `target` declaration
4. Add the `OptimoveSDK` to the target's dependencies list: `pod 'OptimoveSDK', '~> 2.0'`
    `Podfile` code snippet:
    
    ```ruby
    platform :ios, '10.0'
    # Update "target" accordingly to support silent minor upgrades
    target '<YOUR_TARGET_NAME>' do
        use_frameworks!
        pod 'OptimoveSDK', '~> 2.0'
    end
    ```

5. From your terminal, run `pod install`
6. Cocoapods will generate a **_Workspace_** file `*.xcworkspace` - use this workspace file from now on

### Via Carthage

1. If you haven't already, install Carthage (https://github.com/Carthage/Carthage#installing-carthage)
2. Create or update a Cartfile:
    ```
    github "optimove-tech/Optimove-SDK-iOS"
    ```

3. Run `carthage update`.
4. Choose a target for adding Optimove in an XCode project.
5. Add the SDK to ***Linked Frameworks and Libraries*** by dragging the new components from `Carthage/Build/iOS`.
6. Add the `$(OTHER_LDFLAGS) -ObjC` flag to `Other Linker Flags` in ***Build Settings*** for the **App** target.
7. Delete [Firebase.framework](https://github.com/firebase/firebase-ios-sdk/issues/911#issuecomment-372455235) from the ***Link Binary With Libraries*** of the `Build Phase` tab.
8. Add the path under ***Input Files***:
    ```
    $(SRCROOT)/Carthage/Build/iOS/OptimoveCore.framework
    ```

> - Note that you shouldn't add the Optimove and Firebase frameworks to the Carthage build phase (`copy-frameworks`). The frameworks include static libraries that are linked at build time.
> - Since Optimove SDK uses a [Firebase](https://github.com/firebase/firebase-ios-sdk) dependency you can verify [installation on Firebase components](https://github.com/firebase/firebase-ios-sdk/blob/master/Carthage.md).
---
> **Important Note for Cocoapods and Carthage**: 
> Use the `~>` operator to seamlessly get the latest, backwards-compatible, Optimove SDK. Every time you'd run `pod update` or `cart update` you'll get the latest stable version.

## 2. Adding Optimove SDK Details
You will receive from Optimove Product Integration team the following details to add to your SDK initialization:

- ***YOUR_OPTIMOVE_TENANT_TOKEN*** – Your unique SDK token in order to identify you from other SDKs
- ***YOUR_OPTIMOVE_CONFIG_NAME*** – The mobile config used to store your app events

Call the SDK's initialization function from your `AppDelegate`'s `application(_:didFinishLaunchingWithOptions:)` callback. Then make sure to register for remote notifications (mandatory step) by calling `UIApplication.shared.registerForRemoteNotifications()`. See code example below:

```swift
class AppDelegate: UIResponder, UIApplicationDelegate {

    func application(_ application: UIApplication, didFinishLaunchingWithOptions launchOptions: [UIApplicationLaunchOptionsKey: Any]?) -> Bool {
        // Initialize the Optimove SDK
        let info = OptimoveTenantInfo(tenantToken: "<YOUR_TENANT_TOKEN>", configName:"<YOUR_CONFIG_NAME>")
        Optimove.configure(for: info)
        
        // Register Remote Notification Registration - a must
        UIApplication.shared.registerForRemoteNotifications()
    }

}
```

## 3. Optional: Direct Firebase SDK dependency
If you already using the Firebase SDK, you must initialize your `FirebaseApp` before initializing our SDK by calling `FirebaseApp.configure()` before `Optimove.configure(for:)`
Note: Failing to add this function when you are already using your own Firebase SDK will cause unexpected behavior, as well as crashes.

See code snippet example below:

```swift
class AppDelegate: UIResponder, UIApplicationDelegate {

    func application(_ application: UIApplication, didFinishLaunchingWithOptions launchOptions: [UIApplicationLaunchOptionsKey: Any]?) -> Bool {
        //Add this "before" Optimove.configure(for: info) - a must 
        FirebaseApp.configure()
        
        // Initialize the Optimove SDK
        let info = OptimoveTenantInfo(tenantToken: "<YOUR_TENANT_TOKEN>",configName:"<YOUR_CONFIG_NAME>")
        Optimove.configure(for: info)
        
        // Mandatory Remote Notification Registration
        UIApplication.shared.registerForRemoteNotifications()
    }

}
```

## 4. AppDelegate Callbacks Forwarding
In order to forward the AppDelegate Callbacks, inside your `AppDelegate` class, locate/implement the following callbacks accordingly:

See code snippet example below:

```swift
func application(_ application: UIApplication,
                    didReceiveRemoteNotification userInfo: [AnyHashable: Any],
                    fetchCompletionHandler completionHandler: @escaping (UIBackgroundFetchResult) -> Void) {
    let isHandledByOptimove = Optimove.shared.didReceiveRemoteNotification(userInfo: userInfo, didComplete: completionHandler)
    if isHandledByOptimove { return }
    // The remote notification didn't originate from Optimove's servers, so the app must handle it. Below is the default implementation
    completionHandler(.noData)
}

func application(_ application: UIApplication,
                    didRegisterForRemoteNotificationsWithDeviceToken deviceToken: Data) {
    Optimove.shared.application(didRegisterForRemoteNotificationsWithDeviceToken: deviceToken)
}
```

## 5. Setting up Capabilities
To setup Capabilities, open the **Capabilities** page for your Application's App Target as follows:

1. Enable the `Push Notifications` capability
2. Enable the `Remote Notifications` capability within `Background Modes`
3. Enable the `App Groups` capability and add the following group: `group.<YOUR_APP_BUNDLE_ID>.optimove`

[![Screen-Shot-2019-07-22-at-19-19-39.png](https://i.postimg.cc/dDMZ9mRd/Screen-Shot-2019-07-22-at-19-19-39.png)](https://postimg.cc/2Lw5kWK8)
[![Screen-Shot-2019-07-22-at-19-20-06.png](https://i.postimg.cc/wv7SXhj9/Screen-Shot-2019-07-22-at-19-20-06.png)](https://postimg.cc/cgG9Zt3z)
